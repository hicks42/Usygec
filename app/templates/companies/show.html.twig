{% extends 'bam_base.html.twig' %}

{% block title %}
	{{ company.name }}
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block javascripts %}
	{{ parent() }}
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js" integrity="sha512-LGXaggshOkD/at6PFNcp2V2unf9LzFq6LE+sChH7ceMTDP0g2kn6Vxwgg7wkPP7AAtX+lmPqPdxB47A0Nz0cMQ==" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.31/moment-timezone-with-data.js"></script>
	{{ encore_entry_script_tags('activity') }}
	{# {{ encore_entry_script_tags('datepicker') }} #}
	{{ encore_entry_script_tags('flatpickr') }}
{% endblock javascripts %}

{% block content %}
	<div class="d-flex justify-content-between w-100">
		<div id="left-side" class="d-flex flex-column justify-content-between w-25">
			<div>
				<div>
					<h3>{{ company.name }}</h3>
					{% if company.category is not empty %}
						{{ company.category }}
					{% endif %}
				</div>
				<p>
					{% if company.civ is not empty %}
						<i class="fa-solid fa-id-badge mt-5 me-1"></i>
						{{ company.civ }}
					{% endif %}
					{% if company.contactFirstName is not empty %}
						<strong>{{ company.contactFirstName }}
						</strong>
					{% endif %}
					{% if company.contactLastName is not empty %}
						<strong>{{ company.contactLastName }}</strong>
						<br>
					{% endif %}
					<div class="d-flex justify-content-start mt-3">
						<div>
							<i class="fa-solid fa-envelope me-2"></i>
						</div>
						<div class="flex-column">
							{% if company.address1 is not empty %}
								{{ company.address1 }}<br>
							{% endif %}
							{% if company.address2 is not empty %}
								{{ company.address2 }}<br>
							{% endif %}
							{% if company.cp is not empty %}
								<strong>{{ company.cp }}</strong><br>
							{% endif %}
							{% if company.city is not empty %}
								{{ company.city }}<br>
							{% endif %}
						</div>
					</div>
				</p>
				{% if company.phone is not empty %}
					<p>
						<strong>
							<i class="fa-solid fa-square-phone mt-3 me-1"></i>:
							{{ company.phone }}</strong>
					</p>
				{% endif %}
				{% if company.mobile is not empty %}
					<p>
						<strong>
							<i class="fa-solid fa-mobile-screen-button mt-3 me-1"></i>:
							{{ company.mobile }}</strong>
					</p>
				{% endif %}
				{% if company.email is not empty %}
					<p>
						<strong>
							<i class="fa-solid fa-at mt-3 me-1"></i>
							:
							<a href="mailto:{{ company.email }}">{{ company.email }}</a>
						</strong>
					</p>
				{% endif %}

			</div>
			<div class="d-flex justify-content-between mb-2 w-100">
				<div class="align-top">
					<div class="btn-group btn-group-sm" role="group">
						<a class="btn btn-outline-primary" href="{{ path('app_companies') }}">
							<i class="fa-solid fa-address-book"></i>
							Sociétés</a>
						<a class="btn btn-secondary" href="{{ path('app_companies_edit', {'id': company.id}) }}">
							<i class="fa-solid fa-user-pen"></i>
							Modification</a>
						<a class="btn btn-outline-primary" href="{{ path('app_activities') }}">
							<i class="fa-solid fa-address-book"></i>
							Activités</a>
					</div>
				</div>
			</div>
		</div>
		<div id="right-side" class="w-75">
			{% import "companies/macros/forms.html.twig" as formMacros %}
			{{ form_start(form, {"method": "PATCH"}) }}
			<div class="d-flex justify-content-between w-100">
				<div id="search-container" class="d-flex justify-content-start mb-2">
					<div class="input-group me-1">
						<input id="search-input" type="text" class="form-control" placeholder="Recherche ..." aria-label="Recherche" oninput="searchActivities()">
						<button class="btn btn-outline-secondary" type="button" id="search-button">
							<i class="fa-solid fa-magnifying-glass"></i>
						</button>
					</div>
				</div>
				<div id="tools-container" class="d-flex justify-content-end mb-2 w-50">
					<button id="filter-button" class="btn btn-primary" type="button">
						<i class="fa-solid fa-filter"></i>
						Filtre</button>
					<button type="button" class="add-activity-btn btn btn-success btn-sm w-3 mx-1" data-collection-holder-class="activities">
						<i class="fa-solid fa-file-circle-plus me-1"></i>Ajouter
					</button>

					<button type="submit" class="btn btn-warning">
						<i class="fa-solid fa-file-arrow-down me-1"></i>
						Enregistrer
					</button>
				</div>
			</div>
			<div class="activity-container">
				<div class="activity-content">

					{# ici commencent le form d'ajout de activity #}
					<ul class="activities" data-index="{{ form.activities|length > 0 ? form.activities|last.vars.name + 1 : 0 }}" data-prototype="{{ formMacros.newForm(form.activities.vars.prototype)|e('html_attr') }}"></ul>

					{# ici commencent les activities existantes #}
					{% for row in form.children['activities'].children|reverse %}
						<div class="activity-card my-2 p-2 pb-0">
							<div class="activity-info d-flex justify-content-between">
								<div class="mt-3">
									Activité N° :
									<strong>{{ row.vars.name + 1 }}</strong>
								</div>
								<div class="mt-3">
									Ajouté le
									<strong>
										{{ row.vars.data.createdAt|format_datetime('medium', 'short', locale='fr', timezone='Europe/Paris') }}
									</strong>
								</div>
								<div class="mt-3">
									Modifié le
									<strong>
										{{ row.vars.data.updatedAt|format_datetime('medium', 'short', locale='fr', timezone='Europe/Paris') }}
									</strong>
								</div>
								{# {{ attribute(form.vars.value, 'id') }} //companyid #}
							</div>
							<div class="activ-row">
								{{ formMacros.existForm(row) }}
							</div>
						</div>
					{% endfor %}

				</div>
			</div>
			{# {{ form_end(form) }} #}
			{{ form_widget(form._token) }}
			{{ form_end(form, {'render_rest': false}) }}
		</div>
	</div>
{% endblock %}
