{% extends 'bam_base.html.twig' %}

{% block title %}Actions disponibles pour
	{{ user.company}}
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
{% endblock stylesheets %}

{% block javascripts %}
	{{ parent() }}
	{{ encore_entry_script_tags('modal') }}
{% endblock javascripts %}
{% block content %}
	<div class="row d-flex justify-content-center">
		<div class="col-md-10 col-12">
			<div class="row d-flex justify-content-between my-3 border-bottom">
				<div class="d-flex justify-content-start flex-column col-10 my-2">
					<h3>Compte EZ Review de:</h3>
					<span class="font-weight-bold fs-6 ms-2">
						{{ user.company}}
					</span>
					<span class="text-muted fs-6 ms-1">
						e-mail :
						{{user.email}}</span>

				</div>
				<div class="col-2 align-center">
					<a href="{{ path('ezreview_settings') }}" class="btn btn-secondary btn-sm float-end text-nowrap">
						<i class="fa-solid fa-pen-to-square"></i>
						Configurer</a>
				</div>
			</div>
		</div>
	</div>
	{% if 'ROLE_ADMIN' not in user.roles %}
		<div class="er-row row g-0 rounded overflow-hidden justify-content-center p-2">
			<div class="col-md-10 col-12 my-4">
				<h5>Etablissements:</h5>
				<ul class="structures">
					{% for structure in user.structures %}
						<li>
							<hr>
							<div class="row d-flex flex-wrap justify-content-around align-items-center m-1">
								<div class="col-12 col-md-4 my-3">
									<div class="d-flex flex-column align-items-center">
										<i class="fa-solid fa-building lead my-2"></i>
										{{ structure.name }}
									</div>
								</div>
								<div class="d-flex flex-nowrap justify-content-around col-xl-6 col-12 col-md-8 my-3">
									<a href="{{ path('enquete', {'id': structure.id}) }}" class="btn btn-secondary btn-sm w-3 mx-1">
										<i class="fa-regular fa-envelope lead"></i><br>
										Envoyer mail</a>

									<a href="#" type="button" data-modal-type="email-csv" data-structureid="{{structure.id}}" class="modal-btn btn btn-secondary btn-sm w-3 mx-1">
										<i class="fa-regular fa-file-lines lead"></i><br>
										Envois groupé
									</a>

									<a href="{{ path('qr_gen', {id: structure.id}) }}" type="button" data-structureid="{{structure.id}}" class="qrcode-btn btn btn-secondary btn-sm w-3 mx-1">
										<i class="fa-solid fa-qrcode lead"></i><br>
										Créer un code</a>

								</div>
							</div>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	{% endif %}
</div>

<div class="modal-container d-flex justify-content-around">
	<div class="modal-popup">
		<button class="close-popup">x</button>
		<div class="d-flex justify-content-center">
			<div class="col-10">
				{{ form_start(form, {"method": "POST"}) }}
				<h6 id="form-title" class="my-4">Choisir un fichier CSV contenant des mails.</h6>
				{{ form_row(form.csvFile) }}
				<button type="submit" class="submit-modal w-100">Traiter</button>
				{{ form_widget(form._token) }}
				{{ form_end(form, {'render_rest': false}) }}
			</div>
		</div>
	</div>
</div>{% endblock %}
